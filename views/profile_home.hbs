<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/material-design-iconic-font/2.2.0/css/material-design-iconic-font.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <link rel="stylesheet" href="../profile_home.css">
    <link rel="stylesheet" href="../jqueryui/jquery-ui.css">
    <link rel="stylesheet" href="../jqueryui/jquery-ui.structure.css">
    <link rel="stylesheet" href="../jqueryui/jquery-ui.theme.css">
    <title>Home</title>
</head>
<body>
    
    <nav>
       
         <h4 id="name-user">Welcome {{message}}</h4>
        
        <ul>
            <li><a href="/">Home</a></li>
            <li><a href="/profile">Profile</a></li>
            <li><a id="logout">Log out</a></li>
        </ul>
    </nav>
    {{#if userloggedin}}
        <script>
            localStorage.setItem("userloggedin", "true");
        </script>
    {{/if}}
    {{#if imageuploaded}}
        <script>
            if (window.location.href.indexOf("auth") > -1) {window.location.replace("/profile")};
        </script>
    {{/if}}
    {{#if deletesuccess}}
        <div id="success"><h6 class="alert alert-danger alert-dismissible">
            event deleted</div>
        <script>
            
            setTimeout('$("#success").hide();if (window.location.href.indexOf("auth") > -1) {window.location.replace("/profile");}',1500);
            
        </script>
    {{/if}}

    {{#if successmessage}}
        <div id="success"><h6 class="alert alert-success alert-dismissible">
            successfully changed budget</div>
        <script>
            
            setTimeout('$("#success").hide();if (window.location.href.indexOf("auth") > -1) {window.location.replace("/profile");}',2500);
            
        </script>
    
    {{/if}}
    {{#if insertsuccessmessage}}
        <div id="success"><h6 class="alert alert-success alert-dismissible">
            event added <strong>Successfully!</strong></div>
        <script>
            setTimeout('$("#success").hide();if (window.location.href.indexOf("auth") > -1) {window.location.replace("/profile");}',3500);
        </script>
    
    {{/if}}
    {{#if eventexpensesuccess}}
        <div id="success"><h6 class="alert alert-success alert-dismissible">
            expense added <strong>Successfully!</strong></div>
        <script>
            setTimeout('$("#success").hide();if (window.location.href.indexOf("auth") > -1) {window.location.replace("/profile");}',3500);
        </script>
    {{/if}}
    {{#if addsuccessmessage}}
        <div id="success"><h6 class="alert alert-success alert-dismissible">
            budget added <strong>Successfully!</strong></div>
        <script>
            setTimeout('$("#success").hide();if (window.location.href.indexOf("auth") > -1) {window.location.replace("/profile");}',3500);
        </script>
    
    {{/if}}

    <div class="wrap">
         <form action="/auth/imageupload" method="POST" enctype="multipart/form-data">
         <input type="file" name="file" id="imagefile" accept=".jpg, .jpeg, .png" onChange="validateAndUpload(this)">
        <div class="card" onmouseover="mouseover()" onmouseout="mouseout()">
          
            <img   src="../profileimg.jpg" alt="Profile Image" width="100%"  id="profileimg" >
        {{#if profilepic}}
            <script>
                var pathname = '{{profilepic}}';
                 
                console.log(pathname);
                document.getElementById("profileimg").src="{{profilepic}}"; 
            </script>
        {{/if}}   
            <label for="imagefile">
            <h6 id="choosefiletext">Choose photo</h6>
            </label>
            
        </div>
        <button type="submit" id="filechosen" class="btn uploadphotobutton">Upload</button>
        </form>
        

        <div class="addCard">

            <div class="addcardtext">
            <h4>Manage events here</h4>
            </div>
            <div class="addcard-btn">
            <button id="addcardbutton" class="btn addCard-button">Add Event</button>
            </div>
        </div>
        
    </div>
    <div class="wrap-2">
    <div class="all-added-event-cards">
    

        <script>
            var eventresultlength = '{{eventresult.length}}';
            let msInDay = 1000 * 3600 * 24;
            {{#each eventresult as |object|}}
                
                var startdate=new Date('{{object.E_startdate}}').toLocaleDateString();
                var enddate=new Date('{{object.E_enddate}}').toLocaleDateString();
                var startdatetime = Date.parse(startdate);
                var enddatetime = Date.parse(enddate);
                var today = new Date;
                
                var timelefttostart = startdatetime-today;
                var timelefttoend = enddatetime-today;   
                
                console.log(timelefttoend);           
                var daysleft = Math.ceil((timelefttostart)/msInDay); 
                
                if(daysleft < 0 && timelefttoend > 0){
                    daysleft = 'started';
                }else if(timelefttoend<0){
                    daysleft = 'over';
                }
                else{
                    daysleft = Math.ceil((timelefttostart)/msInDay) + " days left";
                }
                console.log(daysleft);
                console.log({{@index}});
                document.write('<div id="{{@index}}" class="cardsAdded">');
                document.write('<h4 style=" display:inline;cursor: pointer;color: black" id="eventclicked{{@index}}" > <a href="/eventdesc" style=" color: black;text-decoration: none; " >&nbsp; {{object.E_name}}</a></h4> <h4 id="{{@index}}" style="cursor: pointer;display:inline;float: right; transform:rotate(45deg);margin-right:10px;" class="removeevent{{@index}}">+</h4>');
                document.getElementById("eventclicked{{@index}}").addEventListener('click',function(){
                    localStorage.setItem("Timeadded", {{object.E_timeadded}});
                });
                document.write('<p> &nbsp;&nbsp;{{object.E_address}}</p>');  
                document.write('<div><h4 style="display:inline;float: left;">&nbsp;Start Date:&nbsp;</h4><h4 id="startdatecardtextadd{{@index}}" style="display:inline;"></h4>&emsp;&emsp;<h4 style="display:inline;">TYPE: {{object.E_type}}</h4><h4 id="{{@index}}" class="addeventexpense{{@index}}" style="display:inline;float:right;margin-right:10px;cursor: pointer;">+</h4></div>');
                document.getElementById("startdatecardtextadd{{@index}}").innerHTML=startdate;
                document.write('<h4 id="eventexpense/budget" data-toggle="tooltip" title="expense/budget" style="display:inline;float:left; margin-left:-110px;margin-top:10px;">{{object.E_expense}}/{{object.E_budget}}</h4><h4 id="dayslefttext{{@index}}" style="float:right;display:inline;margin-right:10px;">(days left)</h4>')      
                
                document.getElementById("dayslefttext{{@index}}").innerHTML=daysleft;
                
                  

                document.write('</div>');    
                document.write('<style>.addeventexpense{{@index}}:hover{ text-decoration: underline;color: red;}</style>');
                document.write('<style>.removeevent{{@index}}:hover{color: rgb(195, 155, 241);}</style>');
                
                
            {{/each}}
        </script>
         
        <br>
        
       
    </div>   
<div class="left-side-stuff">
    <div class="addorchangebudgetcard-btn">
            <button id="addtotalbudgetbutton" class="btn addtotalbudget-button">Add to total budget</button>
    </div>
    <div class="addorchangebudgetcard-btn">
            <button id="changetotalbudgetbutton" class="btn changetotalbudget-button">change total budget</button>
    </div>
    
    <div class="informationcard">
        <h6 style="padding-top: 7%;">total expense</h6>
        <h3>{{totalexpense}}</h3>
        <hr>
        <h6 style="padding-bottom: 7%;">total budget</h6>
        <h3>{{totalbudget}}</h3>
        <hr size="4">
        <p><b>Time left for next event:</b></p>
        <h2>{{daysleft}}</h2><h4> days</h4> <br>
        <hr size="4">
        <p><b>EXPENSE STATUS:</b></p>
        {{#if expense_status}}
        <div id="expense_status_text">
        <h3>{{expense_status}}</h3><br>
        </div>
        <script>
            var expense_status = "{{expense_status}}";
                if(expense_status =='low'){
                    document.getElementById("expense_status_text").style.color = "#00FF00";
                }else if(expense_status == 'balanced'){
                    document.getElementById("expense_status_text").style.color = "yellow";
                }else if(expense_status == 'critical'){
                    document.getElementById("expense_status_text").style.color = "#FF8C00";
                }else if(expense_status == 'exceeded'){
                    document.getElementById("expense_status_text").style.color = "red";
                }
        </script>
        
        {{/if}}

        
    </div>
</div>
</div>
    
    <div class="bg-modal-addtotalbudget">
        <div class="modal-content">
            <div class="close">
                +
            </div>
            <form onsubmit="return validateaddbudget()" action="/auth/addbudget" method="POST">
                <div class="wrap-input validate-input" data-validate="Enter valid number">
                    <input id="addtobudgetinput" type="decimal" class="input" name="budget_total_add">  
                    <span class="focus-input" data-placeholder="Enter amount"></span>   
                </div>
                
                <button class="btn addtotalbudgetsubmit-btn">Add</button>
            </form>

        </div>
    </div>
    
    
    <div  class="bg-modal-changetotalbudget">
        <div class="modal-content">
            <div class="changeclose">
                +
            </div>
            <form onsubmit="return validatechange()" action="/auth/profile" method="POST">
                <div class="wrap-input validate-input" data-validate="Enter valid number">
                    <input id="changeinput"type="decimal" class="input" name="budget_total_change" {{!--  required --}}="decimal(10,2)">  
                    <span class="focus-input" data-placeholder="Change Budget to"></span>   
                </div>
                
                <button type="submit" class="btn changetotalbudgetsubmit-btn">Change</button>
            </form>

        </div>
    </div>
    

    <div  class="bg-modal-deleteevent">
        <div class="modal-content">
            <div class="deleteeventpopupclose">
                +
            </div>
            <form action="/auth/deleted" method="POST">
            {{#if eventresult}}
                <input type="hidden" name="clickedeventtimedelete" style="display: none;" id="deletetimeinput">
                <script>
                    

                    {{#each eventresult as |object|}}

                    document.querySelector(".removeevent{{@index}}").addEventListener('click', function(){
                        var timetodelete = '{{object.E_timeadded}}';
                        document.querySelector('.bg-modal-deleteevent').style.display = 'flex';
                        window.scrollTo(0,0);
                        document.body.style.overflow= "hidden";
                        document.getElementById("deletetimeinput").value =timetodelete;

                    });
                    
                    {{/each}}
                </script>
                

                {{/if}}
                <h5 style="color:blue;font-weight:bold;">Are you sure you want to delete this event ?</h5>
                
                    
                <button type="submit" class="btn deleteeventsubmit-btn" style="margin-left: 40%;margin-top: 10%;">Delete</button>
                
                
            </form>

        </div>
    </div>


    <div  class="bg-modal-addeventexpense">
        <div class="modal-content">
            <div class="eventexpensepopupclose">
                +
            </div>
            <form onsubmit="return validateeventexpense()" action="/auth/addeventexpense" method="POST">

                <input type="hidden" name="clickedeventtimeadded" style="display: none;" id="addexpensetimeinput">
                {{#if eventresult}}
                <script>
                    {{#each eventresult as |object|}}
                    document.querySelector(".addeventexpense{{@index}}").addEventListener('click', function(){
                        var addexpenseclicktimeadded = '{{object.E_timeadded}}';
                        document.querySelector('.bg-modal-addeventexpense').style.display = 'flex';
                        window.scrollTo(0,0);
                        document.body.style.overflow= "hidden";
                        document.getElementById("addexpensetimeinput").value =addexpenseclicktimeadded;

                    });
                    
                    {{/each}}
                </script>

                {{/if}}

                <div class="wrap-input validate-input" data-validate="Enter expense name">
                    <input id="addeventexpensenameinput"type="text" class="input" name="event_expense_name">  
                    <span class="focus-input" data-placeholder="Expense name"></span>   
                </div>
                <div class="wrap-input validate-input" data-validate="Enter valid expense">
                    <input id="addeventexpenseamountinput" type="decimal" class="input" name="event_expense_amount">  
                    <span class="focus-input" data-placeholder="Expense amount"></span>   
                </div>
                
                <button type="submit"  class="btn addeventexpensesubmit-btn">Add expense</button>
            </form>

        </div>
    </div>
    
    <div class="bg-modal-addevent">
        <div class="modal-content-addevent">
            <div class="addeventpopupclose">
                +
            </div>
            <form onsubmit="return validate()" class="addevent-form validate-form" action="/auth/addevent" method="post">
                <br><br>
                <div class="wrap-input-1 validate-input" data-validate="Enter event name">
                    <input id="addeventname" type="text" class="input" name="E_name" {{!--  required --}}>   
                    <span class="focus-input" data-placeholder="Event Name"></span>  
                </div>
                <div class="wrap-input-1 validate-input" data-validate="Enter event address">
                    <input id="addeventaddress" type="text" class="input" name="E_address" {{!--  required --}}>  
                    <span class="focus-input" data-placeholder="Event address"></span>
                </div>
                <div class="wrap-input-1 validate-input" data-validate="Enter event type">
                    <select id="addeventtype" type="text" class="input" name="E_type" {{!--  required --}}>
                        <option disabled selected hidden></option>
                        <option>seminar</option>
                        <option>conference</option>
                        <option>party</option>
                    </select>  
                    
                    
                </div>
                <div class="para">
                <p style="font-size: small;">(Event Type)</p>
                </div>
                <br>
                <div class="wrap-input-1 validate-input" data-validate="Enter event budget" >
                    <input id="addeventbudget" type="decimal(10,2)" class="input" name="E_budget" {{!--  required --}} >  
                    <span class="focus-input" data-placeholder="Event budget"></span>
                </div>
            
                <div class="wrap-input-1 validate-input" data-validate="Enter event startdate">
                    <input id="addeventstartdate" type="date" class="input" name="E_startdate" {{!--  required --}}>  
                    <span class="focus-input" data-placeholder=""></span> 
                    
                </div>
                <div class="para">
                <p style="font-size: small;">(Event start date)</p>
                </div>
                <br><br>
                <div class="wrap-input-1 validate-input" data-validate="Enter event enddate">
                    <input id="addeventenddate" type="date" class="input" name="E_enddate" {{!--  required --}}>  
                    <span class="focus-input" data-placeholder=""></span>
                    
                </div>
                <div class="para"><p style="font-size: small;">(Event end date)</p></div>    
                


                <button class="btn addeventsubmit-btn" type="submit">Add Event</button>
            </form>

        </div>
    </div>


    
    

    {{!-- <div class="container mt-4">
        <div class="jumbotron">
            <h1 class="display-4">Welcome</h1>
            <p class="lead">This is a simple event management application that is presented as our mini project for the 5th sem DBMS subject.</p>
            <hr class="my-4">
            <p>Here is an example application of individual event management applications.</p>
            <p class="lead">
              <a class="btn btn-primary btn-lg" href="/login" role="button">Login</a>
            </p>
          </div>
        
    </div> --}}

    <script src="../jquery.js" type="text/javascript"></script>
    <script src="../jqueryui/jquery-ui.js" type="text/javascript"></script>
    <script src="../profile_home.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
</body>
</html>